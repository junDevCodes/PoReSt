# 진행 현황 및 다음 작업 정리 (2026-02-07)

## 1차 업데이트 (M1 Project API + 테스트)
- 네트워크 점검
  - 대상: `ep-ancient-lab-a1thqeig.ap-southeast-1.aws.neon.tech:5432`
  - 결과: `TcpTestSucceeded: True`
- Project 도메인/라우트 구현
  - Public: `GET /api/public/projects`, `GET /api/public/projects/[slug]`, `GET /api/public/portfolio`
  - Private: `GET/POST /api/app/projects`, `GET/PUT /api/app/projects/[id]`
- 핵심 에러 정책 반영
  - slug 중복(`P2002`) -> `409`
  - `isFeatured=true && visibility!=PUBLIC` -> `422`
  - owner scope 불일치 -> `403`
  - slug 미존재 -> `404`
- 테스트 추가
  - `src/modules/projects/tests/validation.test.ts`
  - `src/modules/projects/tests/implementation.integration.test.ts`

## 2차 업데이트 (마이그레이션 안정화 + 삭제/경험 API)
- 마이그레이션 체인 안정화
  - 파일: `prisma/migrations/20260206170000_m1_schema_reset/migration.sql`
  - `DROP SCHEMA public CASCADE` 제거, 객체 단위 `DROP IF EXISTS ... CASCADE`로 전환
  - 검증: `prisma migrate reset`, `prisma migrate status` 통과
- Project 삭제 API 추가
  - `DELETE /api/app/projects/[id]`
  - 테스트: `src/modules/projects/tests/project-delete.integration.test.ts`
- Experiences CRUD 추가
  - 모듈: `src/modules/experiences/*`
  - 라우트: `src/app/api/app/experiences/route.ts`, `src/app/api/app/experiences/[id]/route.ts`
  - owner scope + featured/visibility 규칙 + `401/403/404/409/422` 매핑 반영
  - 테스트: `src/modules/experiences/tests/implementation.integration.test.ts`

## 3차 업데이트 (PortfolioSettings Private API)
- API 구현
  - `GET /api/app/portfolio/settings`
  - `PUT /api/app/portfolio/settings`
- 모듈 구현
  - `src/modules/portfolio-settings/*`
- 규칙 반영
  - 설정 미존재 조회: `200 { data: null }`
  - 최초 생성 시 `publicSlug` 필수 (`422`)
  - links 전달 시 전체 교체(`deleteMany + create`)
  - `publicSlug` unique 충돌(`P2002`) -> `409`
- 테스트 추가
  - `src/modules/portfolio-settings/tests/validation.test.ts`
  - `src/modules/portfolio-settings/tests/implementation.integration.test.ts`

## 4차 업데이트 (M1 마감 준비: UI/SEO/게이트)
- 로그인 경로 정리
  - `/login` 페이지 추가, `/auth/signin` 호환 유지
  - 미들웨어 리다이렉트 경로 `/login`으로 통일
- Public 페이지 실데이터 바인딩
  - `/` -> portfolio 데이터 연동 + featured/links 렌더
  - `/projects` -> 공개 목록 렌더
  - `/projects/[slug]` -> 상세 템플릿 렌더 + 404 처리
  - `revalidate = 60` 적용
- Private 최소 CRUD UI
  - `/app/portfolio/settings`
  - `/app/projects`
  - `/app/experiences`
- SEO 필수 항목
  - `src/app/sitemap.ts`
  - `src/app/robots.ts`
  - Private 레이아웃 `noindex` 적용
- 게이트 검증
  - `npm run lint` 통과
  - `npm run build` 통과
  - `.env.local` 로드 후 `npx jest --runInBand` 통과 (9/9 suite, 34/34 test)

## 5차 업데이트 (배포 반영 + 운영 검증)
- 배포 반영
  - Preview 배포 완료 (2026-02-08)
  - Production 배포 완료 (2026-02-08)
  - 배포 기준 커밋: `c5f30fd`
- 배포 URL
  - Preview: `https://porest-ivxws22k6-joonaengs-projects.vercel.app`
  - Production: `https://porest-eight.vercel.app`
  - Production 커스텀 도메인: `https://www.jundevcodes.info`
- 수동 스모크 확인
  - Public: `/`, `/projects`, `/projects/[slug]` 접근 확인
  - Private: 비인증 `/app/*` -> `/login?next=...` 리다이렉트 확인
  - 인증 후 next 복귀 및 `/app/portfolio/settings`, `/app/projects`, `/app/experiences` 기본 동작 확인
  - API 에러 매핑(401/403/404/409/422) 회귀 없음

## 6차 업데이트 (M1.1 보강: 작성 UX + 보안 + 즉시 반영)
- Admin 작성 UX 분리
  - `/app/projects/new`, `/app/projects/[id]/edit` 페이지 추가
  - 공용 폼 컴포넌트: `src/components/projects/ProjectForm.tsx`
  - 입력 모델/검증: `src/types/project-form.ts` (Zod + React Hook Form)
  - `/app/projects` 목록 화면을 정렬/필터 + 빠른 액션 중심으로 재구성
- Public 즉시 반영 보강
  - `POST /api/app/revalidate` 추가: `src/app/api/app/revalidate/route.ts`
  - 프로젝트/경력/포트폴리오 설정 변경 시 revalidate 호출 연계
- 보안 보강
  - JSON 요청 본문 1MB 제한 적용: `src/lib/request-json.ts`
  - 허용 URL 스킴 제한(`http/https`) 적용: `src/view-models/public-portfolio.ts`
- 테스트 보강
  - URL 스킴 필터링 테스트 추가: `src/view-models/__tests__/public-portfolio.test.ts`
  - JSON 본문 크기 제한 테스트 추가: `src/lib/__tests__/request-json.test.ts`
- 게이트 상태
  - `npm run lint` 통과
  - `npm run build` 통과
  - `npx jest --runInBand` 통과
  - 참고: `DATABASE_URL_TEST` 인증정보가 현재 로컬 값과 불일치하면 통합 테스트 4개 스위트는 DB 인증 실패로 실패할 수 있음

## 배포 상태
- Preview/Production 배포 완료
- 배포 방식: GitHub 연동 파이프라인(Preview -> 승인 -> Production)
- 운영 반영 기준 커밋: `c5f30fd` (2026-02-08)

## 문서/추적 동기화
- `plans/task.md` M1 완료 항목 최신화
- `plans/checklist.md` M1 완료 항목/게이트 상태 최신화
- `results/m1_alignment_2026-02-07.md` FR/AC 일치도 매트릭스 추가

## M1 잔여 항목 (명시적 보류)
1. OG 이미지 자산 고도화 및 Open Graph 검증
2. 이미지 최적화(Next/Image)와 Lighthouse 90+
3. Markdown 리치 에디터/이미지 업로드 고도화
