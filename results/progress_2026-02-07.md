# 진행 현황 및 다음 작업 정리 (2026-02-07)

## 1차 업데이트 (M1 Project API + 테스트)
- 네트워크 점검
  - 대상: `ep-ancient-lab-a1thqeig.ap-southeast-1.aws.neon.tech:5432`
  - 결과: `TcpTestSucceeded: True`
- Project 도메인/라우트 구현
  - Public: `GET /api/public/projects`, `GET /api/public/projects/[slug]`, `GET /api/public/portfolio`
  - Private: `GET/POST /api/app/projects`, `GET/PUT /api/app/projects/[id]`
- 핵심 에러 정책 반영
  - slug 중복(`P2002`) -> `409`
  - `isFeatured=true && visibility!=PUBLIC` -> `422`
  - owner scope 불일치 -> `403`
  - slug 미존재 -> `404`
- 테스트 추가
  - `src/modules/projects/tests/validation.test.ts`
  - `src/modules/projects/tests/implementation.integration.test.ts`

## 2차 업데이트 (마이그레이션 안정화 + 삭제/경험 API)
- 마이그레이션 체인 안정화
  - 파일: `prisma/migrations/20260206170000_m1_schema_reset/migration.sql`
  - `DROP SCHEMA public CASCADE` 제거, 객체 단위 `DROP IF EXISTS ... CASCADE`로 전환
  - 검증: `prisma migrate reset`, `prisma migrate status` 통과
- Project 삭제 API 추가
  - `DELETE /api/app/projects/[id]`
  - 테스트: `src/modules/projects/tests/project-delete.integration.test.ts`
- Experiences CRUD 추가
  - 모듈: `src/modules/experiences/*`
  - 라우트: `src/app/api/app/experiences/route.ts`, `src/app/api/app/experiences/[id]/route.ts`
  - owner scope + featured/visibility 규칙 + `401/403/404/409/422` 매핑 반영
  - 테스트: `src/modules/experiences/tests/implementation.integration.test.ts`

## 3차 업데이트 (PortfolioSettings Private API)
- API 구현
  - `GET /api/app/portfolio/settings`
  - `PUT /api/app/portfolio/settings`
- 모듈 구현
  - `src/modules/portfolio-settings/*`
- 규칙 반영
  - 설정 미존재 조회: `200 { data: null }`
  - 최초 생성 시 `publicSlug` 필수 (`422`)
  - links 전달 시 전체 교체(`deleteMany + create`)
  - `publicSlug` unique 충돌(`P2002`) -> `409`
- 테스트 추가
  - `src/modules/portfolio-settings/tests/validation.test.ts`
  - `src/modules/portfolio-settings/tests/implementation.integration.test.ts`

## 4차 업데이트 (M1 마감 준비: UI/SEO/게이트)
- 로그인 경로 정리
  - `/login` 페이지 추가, `/auth/signin` 호환 유지
  - 미들웨어 리다이렉트 경로 `/login`으로 통일
- Public 페이지 실데이터 바인딩
  - `/` -> portfolio 데이터 연동 + featured/links 렌더
  - `/projects` -> 공개 목록 렌더
  - `/projects/[slug]` -> 상세 템플릿 렌더 + 404 처리
  - `revalidate = 60` 적용
- Private 최소 CRUD UI
  - `/app/portfolio/settings`
  - `/app/projects`
  - `/app/experiences`
- SEO 필수 항목
  - `src/app/sitemap.ts`
  - `src/app/robots.ts`
  - Private 레이아웃 `noindex` 적용
- 게이트 검증
  - `npm run lint` 통과
  - `npm run build` 통과
  - `.env.local` 로드 후 `npx jest --runInBand` 통과 (9/9 suite, 34/34 test)

## 5차 업데이트 (배포 반영 + 운영 검증)
- 배포 반영
  - Preview 배포 완료 (2026-02-08)
  - Production 배포 완료 (2026-02-08)
  - 배포 기준 커밋: `c5f30fd`
- 배포 URL
  - Preview: `https://porest-ivxws22k6-joonaengs-projects.vercel.app`
  - Production: `https://porest-eight.vercel.app`
  - Production 커스텀 도메인: `https://www.jundevcodes.info`
- 수동 스모크 확인
  - Public: `/`, `/projects`, `/projects/[slug]` 접근 확인
  - Private: 비인증 `/app/*` -> `/login?next=...` 리다이렉트 확인
  - 인증 후 next 복귀 및 `/app/portfolio/settings`, `/app/projects`, `/app/experiences` 기본 동작 확인
  - API 에러 매핑(401/403/404/409/422) 회귀 없음

## 6차 업데이트 (M1.1 보강: 작성 UX + 보안 + 즉시 반영)
- Admin 작성 UX 분리
  - `/app/projects/new`, `/app/projects/[id]/edit` 페이지 추가
  - 공용 폼 컴포넌트: `src/components/projects/ProjectForm.tsx`
  - 입력 모델/검증: `src/types/project-form.ts` (Zod + React Hook Form)
  - `/app/projects` 목록 화면을 정렬/필터 + 빠른 액션 중심으로 재구성
- Public 즉시 반영 보강
  - `POST /api/app/revalidate` 추가: `src/app/api/app/revalidate/route.ts`
  - 프로젝트/경력/포트폴리오 설정 변경 시 revalidate 호출 연계
- 보안 보강
  - JSON 요청 본문 1MB 제한 적용: `src/lib/request-json.ts`
  - 허용 URL 스킴 제한(`http/https`) 적용: `src/view-models/public-portfolio.ts`
- 테스트 보강
  - URL 스킴 필터링 테스트 추가: `src/view-models/__tests__/public-portfolio.test.ts`
  - JSON 본문 크기 제한 테스트 추가: `src/lib/__tests__/request-json.test.ts`
- 게이트 상태
  - `npm run lint` 통과
  - `npm run build` 통과
  - `npx jest --runInBand` 통과
  - 참고: `DATABASE_URL_TEST` 인증정보가 현재 로컬 값과 불일치하면 통합 테스트 4개 스위트는 DB 인증 실패로 실패할 수 있음

## 7차 업데이트 (M2 착수: Resume API/UI/테스트 1차)
- M2 Resume 모듈/라우트 추가
  - 모듈: `src/modules/resumes/interface.ts`, `src/modules/resumes/implementation.ts`, `src/modules/resumes/http.ts`, `src/modules/resumes/index.ts`
  - API:
    - `GET/POST /api/app/resumes`
    - `GET/PUT/DELETE /api/app/resumes/[id]`
    - `GET/POST /api/app/resumes/[id]/items`
    - `PUT/DELETE /api/app/resumes/[id]/items/[itemId]`
    - `GET /api/app/resumes/[id]/preview`
- M2 Resume 관리자 UI 추가
  - `/app/resumes`
  - `/app/resumes/new`
  - `/app/resumes/[id]/edit`
  - 대시보드 빠른 링크 추가: `/app` -> `/app/resumes`
- 테스트 추가
  - `src/modules/resumes/tests/validation.test.ts`
  - `src/modules/resumes/tests/implementation.integration.test.ts`
- 게이트 검증(2026-02-08)
  - `npm run lint` 통과
  - `npm run build` 통과
  - `npx jest --runInBand` 통과 (DB 통합 스위트 5개 skip)
- 차단 이슈
  - `.env.local` 로드 후 Resume 통합 테스트 단독 실행 시 DB 인증 실패
  - 오류: `Authentication failed against the database server`
  - 조치 필요: `DATABASE_URL_TEST` 계정/비밀번호/브랜치 URL 재확인 후 통합 스위트 재실행

## 8차 업데이트 (M2 Resume UI 보강: 정렬/Override)
- Resume 편집 UI 보강
  - 파일: `src/app/(private)/app/resumes/[id]/edit/page.tsx`
  - Drag & Drop 순서 정렬 추가(항목 카드 드래그 후 순서 저장)
  - Override 편집 UI 확장
    - `overrideBulletsJson`
    - `overrideMetricsJson`
    - `overrideTechTags`, `notes` 기존 유지
- 정렬 로직 유틸/테스트 추가
  - 유틸: `src/app/(private)/app/resumes/_lib/reorder.ts`
  - 테스트: `src/app/(private)/app/resumes/_lib/__tests__/reorder.test.ts`
  - 검증: 이동 순서 계산 + sortOrder 재계산(간격 10) 통과
- 게이트 재검증(2026-02-08)
  - `npm run lint` 통과
  - `npm run build` 통과
  - `npx jest --runInBand` 통과 (13 suite 중 8 pass, 5 skip)

## 9차 업데이트 (M2 Resume 비교 UI + 테스트 확장)
- 원본 vs 수정본 비교 UI 추가
  - 파일: `src/app/(private)/app/resumes/[id]/edit/page.tsx`
  - 항목별로 원본(Experience)과 수정본(override/resolved)을 나란히 표시
  - override 적용 여부(`bullets/metrics/tags`) 시각화
- 비교 유틸/테스트 추가
  - 유틸: `src/app/(private)/app/resumes/_lib/compare.ts`
  - 테스트: `src/app/(private)/app/resumes/_lib/__tests__/compare.test.ts`
- 게이트 재검증(2026-02-08)
  - `npm run lint` 통과
  - `npm run build` 통과
  - `npx jest --runInBand` 통과 (14 suite 중 9 pass, 5 skip)

## 10차 업데이트 (M2 Resume PDF 다운로드)
- PDF 다운로드 기능 추가
  - 파일: `src/app/(private)/app/resumes/[id]/edit/page.tsx`
  - 프리뷰 영역에 `PDF 다운로드` 버튼 추가
  - 프리뷰 데이터 기반 인쇄 창 호출 후 브라우저 `PDF로 저장` 지원
- PDF 유틸/테스트 추가
  - 유틸: `src/app/(private)/app/resumes/_lib/pdf.ts`
  - 테스트: `src/app/(private)/app/resumes/_lib/__tests__/pdf.test.ts`
  - 보안: HTML escape 처리로 사용자 입력 문자열 주입 방지
- 게이트 재검증(2026-02-09)
  - `npm run lint` 통과
  - `pdf/reorder/compare` 유틸 테스트 통과

## 11차 업데이트 (M2 Resume 동기화 배지/알림)
- 동기화 상태 배지 추가
  - 파일: `src/app/(private)/app/resumes/[id]/edit/page.tsx`
  - 기준: `resume item.updatedAt` vs `experience.updatedAt`
  - 상태: `동기화됨`, `원본 변경됨`, `판별 불가`
- 동기화 유틸/테스트 추가
  - 유틸: `src/app/(private)/app/resumes/_lib/sync.ts`
  - 테스트: `src/app/(private)/app/resumes/_lib/__tests__/sync.test.ts`
- 동기화 알림 UI(선택) 추가
  - 원본 변경 항목 수가 1개 이상일 때 상단 경고 문구 노출
- 게이트 재검증(2026-02-09)
  - `npm run lint` 통과
  - `npm run build` 통과 (정적 생성 중 DB 인증 경고 로그 출력되나 빌드 완료)
  - `npx jest --runInBand` 통과 (`16 suites`: `11 pass`, `5 skip`)
  - `src/modules/resumes/tests/implementation.integration.test.ts`는 환경 미설정 상태에서 skip

## 12차 업데이트 (M2 통합 테스트 실통과)
- 테스트 DB 인증 정상화 확인
  - `DATABASE_URL_UNPOOLED="$DATABASE_URL_TEST" npx prisma db execute --stdin` (`SELECT 1`) 성공
  - `DATABASE_URL_UNPOOLED="$DATABASE_URL_TEST" npx prisma migrate status` 정상
- Resume 통합 테스트 1건 보정
  - 파일: `src/modules/resumes/tests/implementation.integration.test.ts`
  - 변경: 테스트용 Experience 생성 시 `techTags: []` 기본값 추가
  - 사유: 현재 스키마에서 `techTags`는 필수 배열
- 통합 테스트 5개 스위트 실통과
  - `projects implementation`, `projects delete`, `experiences`, `portfolio-settings`, `resumes`

## 배포 상태
- Preview/Production 배포 완료
- 배포 방식: GitHub 연동 파이프라인(Preview -> 승인 -> Production)
- 운영 반영 기준 커밋: `c5f30fd` (2026-02-08)

## 문서/추적 동기화
- `plans/task.md` M1 완료 항목 최신화
- `plans/checklist.md` M1 완료 항목/게이트 상태 최신화
- `results/m1_alignment_2026-02-07.md` FR/AC 일치도 매트릭스 추가

## M1 잔여 항목 (명시적 보류)
1. OG 이미지 자산 고도화 및 Open Graph 검증
2. 이미지 최적화(Next/Image)와 Lighthouse 90+
3. Markdown 리치 에디터/이미지 업로드 고도화
